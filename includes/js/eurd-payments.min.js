function buildPaymentUrl(e){return"https://pay.quantozpay.com/"+e}function showRedirectNotice(){if(document.querySelector("#eurd-redirect-notice"))return;document.body.insertAdjacentHTML("beforeend",`<div id=eurd-redirect-notice><div class=spinner></div><span>✓ Payment received — redirecting now…</span></div><style>@keyframes eurd-spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}#eurd-redirect-notice{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(0,0,0,.85);color:#fff;padding:20px 30px;border-radius:8px;display:none;align-items:center;font-size:16px;z-index:100000}#eurd-redirect-notice .spinner{width:20px;height:20px;margin-right:12px;border:3px solid #fff;border-top:3px solid rgba(255,255,255,.3);border-radius:50%;animation:eurd-spin 1s linear infinite}</style>`);let e=document.querySelector("#eurd-redirect-notice");jQuery(e).fadeIn(200)}function startOrderPolling(e,r,t=5e3){console.info("[EURD] Polling every",t,"ms for order",r.order_id);let n=setInterval(()=>{console.debug("[EURD] Checking order status…"),e.post(r.ajax_url,{action:"eurd_check_order_status",order_id:r.order_id,EURDPAYFW_nonce:r.nonce},e=>{if(!e.success){console.error("[EURD] Poll error:",e);return}let t=e.data.status;console.debug("[EURD] Status:",t),("completed"===t||"processing"===t)&&(clearInterval(n),showRedirectNotice(),setTimeout(()=>{console.info("[EURD] Redirecting now"),window.location.href=r.confirm_url},2e3))},"json").fail((e,r,t)=>{console.error("[EURD] AJAX failed:",r,t)})},t);return()=>clearInterval(n)}!function(e){"use strict";if(void 0===(e=e||window.jQuery)){console.error("[EURD] jQuery missing - aborting.");return}e(function(){if("undefined"==typeof EURDPAYFWData){console.warn("[EURD] EURDPAYFWData missing - aborting.");return}if(e("#eurd-payment-qr-code").length)try{new QRCode("eurd-payment-qr-code",{text:buildPaymentUrl(EURDPAYFWData.eurd_payment_request_code),width:200,height:200,correctLevel:QRCode.CorrectLevel.H,quietZone:8})}catch(r){console.error("[EURD] Failed to generate QR code:",r)}setTimeout(function(){e("#manualPaymentConfirmBtn").fadeIn()},1e4);try{startOrderPolling(e,{ajax_url:EURDPAYFWData.ajax_url,order_id:EURDPAYFWData.order_id,nonce:EURDPAYFWData.nonce,confirm_url:EURDPAYFWData.confirm_url},5e3)}catch(t){console.error("[EURD] startOrderPolling error:",t)}e("body").on("click",".EURDPAYFW-return-link",function(e){e.preventDefault();let r=EURDPAYFWData.payment_url+"&eurd_payment_request_code="+encodeURIComponent(EURDPAYFWData.eurd_payment_request_code);window.location.href=r}),e("body").on("click","#EURDPAYFW-confirm-payment",function(e){e.preventDefault(),window.location.href=EURDPAYFWData.confirm_url}),e("#eurd-payment-url").attr("href",EURDPAYFWData.eurd_payment_url)})}(window.jQuery);